
# Документация к файлу main.md

## Общая цель программы

Программа представляет собой HTTP-сервер, который предоставляет два эндпоинта для работы с шифром Цезаря: `/encrypt` для шифрования и `/decrypt` для дешифрования текста. Сервер принимает параметры текста и сдвига через GET-запросы и возвращает обработанный текст. Также реализован механизм мониторинга системной нагрузки.

---

## Основные компоненты

### Подключаемые библиотеки
- `<microhttpd.h>`: Используется для реализации HTTP-сервера.  
- `<stdio.h>`, `<stdlib.h>`, `<string.h>`: Базовые библиотеки для ввода/вывода, работы с памятью и строками.  
- `<sys/sysinfo.h>`: Предоставляет доступ к информации о системных ресурсах.  
- `"caesar.h"`: Собственная библиотека для реализации шифра Цезаря.

### Глобальные переменные
- `size_t count`: Счетчик для отслеживания количества запросов.

---

## Основные функции

### 1. `print_system_load(size_t size_text)`
Функция выводит информацию о системной нагрузке при каждом сотом запросе.

**Параметры**  
- `size_text`: Размер текста, обработанного сервером (в байтах).

**Логика работы**  
- Используется `sysinfo` для получения текущей загрузки процессора, объема общей и свободной памяти.  
- Загрузка процессора рассчитывается как среднее за одну минуту.

### 2. `request_handler`
Обрабатывает HTTP-запросы, проверяет параметры и передает их для шифрования или дешифрования.

**Параметры**  
- `cls`: Пользовательские данные (не используются в текущей реализации).  
- `connection`: Объект подключения.  
- `url`: URL запроса.  
- `method`: HTTP-метод (обрабатывается только `GET`).  
- `version`: Версия HTTP-протокола.  
- `upload_data`, `upload_data_size`: Используются для загрузки данных (не применяются для `GET`).  
- `ptr`: Указатель для хранения состояния между вызовами.

**Логика работы**  
- Проверяет наличие параметров `text` и `shift`.  
- В зависимости от URL (`/encrypt` или `/decrypt`) вызывает соответствующую функцию из библиотеки `caesar.h`.  
- Возвращает обработанный текст или сообщение об ошибке.

### 3. `main`
Главная функция программы.  
- Запускает HTTP-сервер на порту 8080 с использованием `MHD_start_daemon`.  
- Устанавливает параметры для ограничения времени подключения, количества потоков и одновременных соединений.  
- Ожидает ввода клавиши для завершения работы.

---

## Особенности реализации

1. **Шифрование и дешифрование**  
   Реализовано через вызовы функций `caesar_encrypt` и `caesar_decrypt` из подключаемого файла `caesar.h`.

2. **Обработка ошибок**  
   Сервер возвращает код ошибки (`400` или `404`), если отсутствуют параметры или запрашивается неизвестный эндпоинт.

3. **Мониторинг системных ресурсов**  
   Информация о загрузке процессора и памяти выводится в консоль при каждом сотом запросе.

---

## Пример использования

1. Запустите сервер, скомпилировав и запустив программу.
2. Отправьте запросы через браузер или инструмент типа `curl`:  
   - Шифрование: `http://localhost:8080/encrypt?text=Hello&shift=3`  
   - Дешифрование: `http://localhost:8080/decrypt?text=Khoor&shift=3`.

3. Сервер вернет обработанный текст в теле ответа.

---

## Требования к окружению

1. GCC или другой компилятор для C.  
2. Библиотека `libmicrohttpd`.  
3. Операционная система с поддержкой `sysinfo` (Linux).